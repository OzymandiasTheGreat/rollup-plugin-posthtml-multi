"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var path=_interopDefault(require("path")),fs=_interopDefault(require("fs-extra")),rollupPluginutils=require("rollup-pluginutils"),posthtml=_interopDefault(require("posthtml")),matchHelper=_interopDefault(require("posthtml-match-helper")),pluginName="posthtml-multi";function index(e){var t=e.extract;void 0===t&&(t=!1);var r=e.fileName;void 0===r&&(r="[name].[ext]");var a=e.watch;void 0===a&&(a=!1);var n=e.importPath,i=e.options;void 0===i&&(i=[{}]);for(var l={},s=Array.isArray(i)?i:[i],o=0,u=s;o<u.length;o+=1){var p=u[o];p._filter=p.include?rollupPluginutils.createFilter(p.include,p.exclude):rollupPluginutils.createFilter("**/*.html",p.exclude)}var h={name:pluginName,resolveImport:async function(e,t){var r=t||e;if(path.isAbsolute(e)&&await fs.pathExists(e))return e;if(n){var a=path.join(path.resolve(n),e);if(await fs.pathExists(a))return a}var i=path.resolve(e),l=path.join(path.resolve(path.dirname(r)),e);return await fs.pathExists(i)?i:await fs.pathExists(l)?l:null},posthtmlHook:function(e,t){var r=this;return function(a){return new Promise(function(n){var i=[];a.match(matchHelper("module[href],include[src],extends[src]"),function(a){i.push(new Promise(function(n){var i=a.attrs.href?a.attrs.href:a.attrs.src;r.resolveImport(i,e).then(function(e){null!==e&&(t.addWatchFile(e),fs.readFile(e).then(function(a){posthtml([r.posthtmlHook(e,t)]).process(a).then(function(){return n()}).catch(function(e){return t.error(e)})}).catch(function(e){return t.error(e)}))}).catch(function(e){return t.error(e)})}))}),Promise.all(i).then(function(){return n(a)}).catch(function(e){return t.error(e)})})}},transform:async function(e,r){for(var n=[],i=0,o=s;i<o.length;i+=1){var u=o[i];u._filter(r)&&n.push(u)}if(!n.length)return null;for(var p=0,c=n;p<c.length;p+=1){var f=c[p];Array.isArray(l[r])||(l[r]=[]),l[r].push((await posthtml(f.plugins||[]).process(e,{parser:f.parser,directives:f.directives})).html),a&&await posthtml([h.posthtmlHook(r,this)]).process(e,{parser:f.parser,directives:f.directives})}return{code:t?"":"export default "+JSON.stringify(l[r][0]),map:{mappings:""}}},generateBundle:async function(e,a,n){if(n&&t)for(var i=function(a,n){void 0===n&&(n=0);var i=e.dir||path.dirname(e.file),l="string"==typeof t?path.extname(t)?path.dirname(t):t:i,s=path.parse(path.basename(a,path.extname(a))+".html"),o=r.replace("[name]",s.name).replace("[ext]",s.ext.substr(1)).replace("[extname]",s.ext);return o=o.includes("[fileNo]")?o.replace("[fileNo]",n||""):n?path.basename(o,".html")+"_"+n+".html":o,o=path.resolve(l,o)},s=0,o=Object.entries(l);s<o.length;s+=1)for(var u=o[s],p=u[0],h=u[1],c=0;c<h.length;c++){var f=i(p,c),m={fileName:f,isAsset:!0,source:h[c]};a[f]=m,delete l[p]}}};return h}module.exports=index;
//# sourceMappingURL=index.js.map
