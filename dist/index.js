"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var path=_interopDefault(require("path")),fs=_interopDefault(require("fs-extra")),rollupPluginutils=require("rollup-pluginutils"),posthtml=_interopDefault(require("posthtml")),matchHelper=_interopDefault(require("posthtml-match-helper")),pluginName="posthtml-multi";function index(t){var e=t.watch;void 0===e&&(e=!1);var r=t.importPath,n=t.options;void 0===n&&(n=[{}]);for(var a={},i=Array.isArray(n)?n:[n],o=0,s=i;o<s.length;o+=1){var l=s[o];l._filter=l.include?rollupPluginutils.createFilter(l.include,l.exclude):rollupPluginutils.createFilter("**/*.html",l.exclude)}var u={name:pluginName,resolveImport:async function(t,e){var n=e||t;if(path.isAbsolute(t)&&await fs.pathExists(t))return t;if(r){var a=path.join(path.resolve(r),t);if(await fs.pathExists(a))return a}var i=path.resolve(t),o=path.join(path.resolve(path.dirname(n)),t);return await fs.pathExists(i)?i:await fs.pathExists(o)?o:null},posthtmlHook:function(t,e){var r=this;return function(n){return new Promise(function(a){var i=[];n.match(matchHelper("module[href],include[src],extends[src]"),function(n){i.push(new Promise(function(a){var i=n.attrs.href?n.attrs.href:n.attrs.src;r.resolveImport(i,t).then(function(t){null!==t&&(e.addWatchFile(t),fs.readFile(t).then(function(n){posthtml([r.posthtmlHook(t,e)]).process(n).then(function(){return a()}).catch(function(t){return e.error(t)})}).catch(function(t){return e.error(t)}))}).catch(function(t){return e.error(t)})}))}),Promise.all(i).then(function(){return a(n)}).catch(function(t){return e.error(t)})})}},transform:async function(t,r){for(var n=[],o=[],s=0,l=i;s<l.length;s+=1){var p=l[s];p._filter(r)&&n.push(p)}if(!n.length)return null;for(var h=0,c=n;h<c.length;h+=1){var f=c[h],m=(await posthtml(f.plugins||[]).process(t,{parser:f.parser,directives:f.directives})).html;o.push(m),f.extract&&(Array.isArray(a[r])||(a[r]=[]),a[r].push({code:m,extract:f.extract})),e&&await posthtml([u.posthtmlHook(r,this)]).process(t,{parser:f.parser,directives:f.directives})}return{code:n.some(function(t){return t.extract})?"":"export default "+JSON.stringify(o[0]),map:{mappings:""}}},generateBundle:async function(t,e,r){if(r)for(var n,i,o,s,l=0,u=Object.entries(a);l<u.length;l+=1){for(var p=u[l],h=p[0],c=p[1],f=0;f<c.length;f++){var m=(n=h,i=c[f].extract,o=void 0,s=void 0,o=function(t,e){return path.resolve(path.join(t,e))},s=t.dir||path.dirname(t.file),"string"==typeof i?path.isAbsolute(i)?path.extname(i)?i:i+".html":path.extname(i)?o(s,i):o(s,i+".html"):o(s,path.basename(n,path.extname(n))+".html")),v={fileName:m,isAsset:!0,source:c[f].code};e[m]=v}delete a[h]}}};return u}module.exports=index;
//# sourceMappingURL=index.js.map
