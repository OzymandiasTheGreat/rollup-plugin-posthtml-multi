import r from"path";import e from"fs-extra";import{createFilter as t}from"rollup-pluginutils";import n from"posthtml";import a from"posthtml-match-helper";var i="posthtml-multi";export default function(o){var s=o.extract;void 0===s&&(s=!1);var l=o.fileName;void 0===l&&(l="[name].[ext]");var c=o.watch;void 0===c&&(c=!1);var u=o.importPath,f=o.options;void 0===f&&(f=[{}]);for(var m={},p=Array.isArray(f)?f:[f],h=0,v=p;h<v.length;h+=1){var d=v[h];d._filter=d.include?t(d.include,d.exclude):t("**/*.html",d.exclude)}var x={name:i,resolveImport:async function(t,n){var a=n||t;if(r.isAbsolute(t)&&await e.pathExists(t))return t;if(u){var i=r.join(r.resolve(u),t);if(await e.pathExists(i))return i}var o=r.resolve(t),s=r.join(r.resolve(r.dirname(a)),t);return await e.pathExists(o)?o:await e.pathExists(s)?s:null},posthtmlHook:function(r,t){var i=this;return function(o){return new Promise(function(s){var l=[];o.match(a("module[href],include[src],extends[src]"),function(a){l.push(new Promise(function(o){var s=a.attrs.href?a.attrs.href:a.attrs.src;i.resolveImport(s,r).then(function(r){null!==r&&(t.addWatchFile(r),e.readFile(r).then(function(e){n([i.posthtmlHook(r,t)]).process(e).then(function(){return o()}).catch(function(r){return t.error(r)})}).catch(function(r){return t.error(r)}))}).catch(function(r){return t.error(r)})}))}),Promise.all(l).then(function(){return s(o)}).catch(function(r){return t.error(r)})})}},transform:async function(r,e){for(var t=[],a=0,i=p;a<i.length;a+=1){var o=i[a];o._filter(e)&&t.push(o)}if(!t.length)return null;for(var l=0,u=t;l<u.length;l+=1){var f=u[l];Array.isArray(m[e])||(m[e]=[]),m[e].push((await n(f.plugins||[]).process(r,{parser:f.parser,directives:f.directives})).html),c&&await n([x.posthtmlHook(e,this)]).process(r,{parser:f.parser,directives:f.directives})}return{code:s?"":"export default "+JSON.stringify(m[e][0]),map:{mappings:""}}},generateBundle:async function(e,t,n){if(n&&s)for(var a=function(t,n){void 0===n&&(n=0);var a=e.dir||r.dirname(e.file),i="string"==typeof s?r.extname(s)?r.dirname(s):s:a,o=r.parse(r.basename(t,r.extname(t))+".html"),c=l.replace("[name]",o.name).replace("[ext]",o.ext.substr(1)).replace("[extname]",o.ext);return c=c.includes("[fileNo]")?c.replace("[fileNo]",n||""):n?r.basename(c,".html")+"_"+n+".html":c,c=r.resolve(i,c)},i=0,o=Object.entries(m);i<o.length;i+=1)for(var c=o[i],u=c[0],f=c[1],p=0;p<f.length;p++){var h=a(u,p),v={fileName:h,isAsset:!0,source:f[p]};t[h]=v,delete m[u]}}};return x}
//# sourceMappingURL=module.js.map
