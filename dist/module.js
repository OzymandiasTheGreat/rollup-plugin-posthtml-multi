import r from"path";import t from"fs-extra";import{createFilter as e}from"rollup-pluginutils";import n from"posthtml";import i from"posthtml-match-helper";var o="posthtml-multi";export default function(a){var s=a.watch;void 0===s&&(s=!1);var c=a.importPath,u=a.options;void 0===u&&(u=[{}]);for(var l={},f=Array.isArray(u)?u:[u],h=0,m=f;h<m.length;h+=1){var p=m[h];p._filter=p.include?e(p.include,p.exclude):e("**/*.html",p.exclude)}var v={name:o,resolveImport:async function(e,n){var i=n||e;if(r.isAbsolute(e)&&await t.pathExists(e))return e;if(c){var o=r.join(r.resolve(c),e);if(await t.pathExists(o))return o}var a=r.resolve(e),s=r.join(r.resolve(r.dirname(i)),e);return await t.pathExists(a)?a:await t.pathExists(s)?s:null},posthtmlHook:function(r,e){var o=this;return function(a){return new Promise(function(s){var c=[];a.match(i("module[href],include[src],extends[src]"),function(i){c.push(new Promise(function(a){var s=i.attrs.href?i.attrs.href:i.attrs.src;o.resolveImport(s,r).then(function(r){null!==r&&(e.addWatchFile(r),t.readFile(r).then(function(t){n([o.posthtmlHook(r,e)]).process(t).then(function(){return a()}).catch(function(r){return e.error(r)})}).catch(function(r){return e.error(r)}))}).catch(function(r){return e.error(r)})}))}),Promise.all(c).then(function(){return s(a)}).catch(function(r){return e.error(r)})})}},transform:async function(r,t){for(var e=[],i=[],o=0,a=f;o<a.length;o+=1){var c=a[o];c._filter(t)&&e.push(c)}if(!e.length)return null;for(var u=0,h=e;u<h.length;u+=1){var m=h[u],p=(await n(m.plugins||[]).process(r,{parser:m.parser,directives:m.directives})).html;i.push(p),m.extract&&(Array.isArray(l[t])||(l[t]=[]),l[t].push({code:p,extract:m.extract})),s&&await n([v.posthtmlHook(t,this)]).process(r,{parser:m.parser,directives:m.directives})}return{code:e.some(function(r){return r.extract})?"":"export default "+JSON.stringify(i[0]),map:{mappings:""}}},generateBundle:async function(t,e,n){if(n)for(var i,o,a,s,c=0,u=Object.entries(l);c<u.length;c+=1){for(var f=u[c],h=f[0],m=f[1],p=0;p<m.length;p++){var v=(i=h,o=m[p].extract,a=void 0,s=void 0,a=function(t,e){return r.resolve(r.join(t,e))},s=t.dir||r.dirname(t.file),"string"==typeof o?r.isAbsolute(o)?r.extname(o)?o:o+".html":r.extname(o)?a(s,o):a(s,o+".html"):a(s,r.basename(i,r.extname(i))+".html")),d={fileName:v,isAsset:!0,source:m[p].code};e[v]=d}delete l[h]}}};return v}
//# sourceMappingURL=module.js.map
